'use strict';/**
 * Pooler22 copyright. all right reserved
 */var map=void 0,markers=[],infowindows=[],mapElement=void 0,listElement=void 0,sidedrawerElement=void 0,isOpenPanel=void 0,edited=!1,lastWidth=void 0,sizeMin=770,buildings=void 0,categories=void 0,places=void 0;function activateModal(){var b=document.createElement('div');b.innerHTML='<div class=\'mui-panel\'><h1>Mapa Politechniki \u0141\xF3dzkiej</h1><br>'+'<p>Niniejsza strona jest projektem od student\xF3w dla student\xF3w i nie tylko.</p>'+'<p>Je\u015Bli znalaz\u0142e\u015B b\u0142\u0105d lub masz jakie\u015B sugestie napisz, link poni\u017Cej:</p>'+'<a href=\'https://docs.google.com/forms/d/e/1FAIpQLSdSOC7mxqPRETVWX9-24MreBA9Rsj3vltYn9lQvl2yPhFvpAw/viewform?c=0&w=1\'><i class="fa fa-envelope-o"></i> Kontakt</a>'+'</div>',b.style.width='400px',b.style.margin='100px auto',b.style.backgroundColor='#fff',mui.overlay('on',b)}//json
function loadJSON(b,c,d){var f=new XMLHttpRequest;f.onreadystatechange=function(){f.readyState===XMLHttpRequest.DONE&&(200===f.status?c&&c(JSON.parse(f.responseText)):d&&d(f))},f.open('GET',b,!0),f.send()}//url query
function getQueryString(){var b={};return window.location.search.substring(1).split('&').forEach(function(c){var d=c.split('=');'undefined'==typeof b[d[0]]?b[d[0]]=decodeURIComponent(d[1]):'string'==typeof b[d[0]]?b[d[0]]=[b[d[0]],decodeURIComponent(d[1])]:b[d[0]].push(decodeURIComponent(d[1]))}),b}function getQueryURL(){var b=getQueryString();if(b.placeId!==void 0){var c=places.filter(function(f){return f.id==b.placeId}),d=getCoordinate(c[0].building);updateMarkerExt(prepareInfoContent(c[0],!0),d)}else if(b.buildingId!==void 0){var _c=buildings.filter(function(d){return d.id==b.buildingId});updateMarkerExt(prepareInfoContent(_c[0]),[{lat:+_c[0].lat,lng:+_c[0].lng}])}}function getCoordinate(b){return b.split(',').map(function(c){var d=buildings.filter(function(f){return f.id==c});return{lat:+d[0].lat,lng:+d[0].lng}})}function prepareInfoContent(b){var c=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return c?b.name+'<br>'+('<a href=?placeId='+b.id+'>Link do lokacji</a>'):b.name+'<br>'+('<a href=?buildingId='+b.id+'>Link do budynku</a>')}//map
function initMap(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:51.752845,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:19.45318,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:18;map=new google.maps.Map(mapElement,{zoom:d}),updateMarkerExt('Witaj na stronie mapy Politechniki \u0141\xF3dzkiej - online. Wybierz z menu po lewej stornie kategori\u0119 i miejsce jakie ci\u0119 interesuj\u0105 albo wyszukaj za pomoc\u0105 wyszukiwarki.',[{lat:b,lng:c}])}function updateMarkerExt1(b,c,d){updateMarkerExt(b,[{lat:+c,lng:+d}])}function updateMarkerExt(b,c){markers.forEach(function(d){d.setMap(null)}),markers=[],c.forEach(function(d){var f=new google.maps.Marker({position:{lat:d.lat,lng:d.lng},map:map});f.setMap(map);var g=new google.maps.InfoWindow({content:b});google.maps.event.addListener(f,'click',function(){infowindows.forEach(function(h){return h.close()}),g.open(map,f)}),0==markers.length&&(g.open(map,f),map.setCenter(f.getPosition())),infowindows.push(g),markers.push(f)}),window.innerWidth<sizeMin&&closeSidedraver()}//list
function extendCategories(b){b.forEach(function(c){c.places=places.filter(function(d){return d.category==c.id}),c.subcategory!==void 0&&extendCategories(c.subcategory)})}function initList(){extendCategories(categories),listElement.innerHTML=printCategories(categories)+printBuildings()}function arrowSpan(){return'<span class="mui--pull-right mui-caret"></span>'}function printBuildings(){return'<strong onclick=\'toggleListElement(this);\'>Budynki'+arrowSpan()+'</strong>'+'<ul style=\'display:none;\'>'+buildings.reduce(function(b,c){return b+prepareLink(c)},'')+'${arrowSpan()}</ul>'}function printCategories(b){return b.reduce(function(c,d){return c+('<li>'+printCategory(d)+'</li>')},'')}function printCategory(b){var c='';return c+='<strong onclick=\'toggleListElement(this);\'>'+(b.name+arrowSpan())+'</strong>',c+='<ul style=\'display:none;\'>',void 0!==b.subcategory&&(c+=printCategories(b.subcategory)),b.places.forEach(function(d){void 0==d.short&&(d.short=''),c+=prepareLink(d,!0)}),c+='</ul>',c}function search(){isOpenPanel||(document.getElementById('js-hide-sidedrawer').click(),768>window.innerWidth&&showSidedrawer()),document.getElementById('search-input').focus()}function filterPlaces(b){b.length?filterList(b):edited&&(edited=!1,initList())}function filterList(b){var c=getSearchResult(b,buildings,!1)+getSearchResult(b,places,!0);edited=!0,listElement.innerHTML=c?'<strong>Wyniki wyszukiwania</strong><ul>'+c+'</ul>':'<strong>Brak wynik\xF3w</strong>'}function prepareUpdateMarker(b){var c=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(c){var d=places.filter(function(f){return f.id==b});updateMarkerExt(prepareInfoContent(d[0],!0),getCoordinate(d[0].building))}}function prepareLink(b){var c=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return c?'<li><a href=\'javascript:prepareUpdateMarker('+b.id+',true);\'>'+b.name+'</a></li>':'<li><a href=\'javascript:updateMarkerExt1("'+prepareInfoContent(b)+'",'+b.lat+','+b.lng+');\'><b>'+b.short+'</b> '+b.name+'</a></li>'}function getSearchResult(b,c){var d=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return c.reduce(function(f,g){return isFunded(b.toLowerCase().trim(),g)?d?f+prepareLink(g,!0):f+prepareLink(g):f},'')}function isFunded(b,c){var d=!1,f=!1;return void 0!==c.tags&&(d=-1!=c.tags.toLowerCase().search(b)),void 0!==c.short_name&&(f=-1!=c.short_name.toLowerCase().search(b)),-1!=c.name.toLowerCase().search(b)||-1!=c.short.toLowerCase().search(b)||d||f}//view
function toggleListElement(b){b.nextSibling.style.display='none'==b.nextSibling.style.display?'block':'none'}function showSidedrawer(){isOpenPanel=!0,mui.overlay('on',{onclose:function onclose(){sidedrawerElement.className=sidedrawerElement.className.replace(' active',''),document.body.appendChild(sidedrawerElement),isOpenPanel=!1}}).appendChild(sidedrawerElement),setTimeout(function(){return sidedrawerElement.className+=' active'},20)}function closeSidedraver(){isOpenPanel=!1,sidedrawerElement.className=sidedrawerElement.className.replace(' ','active'),document.body.appendChild(sidedrawerElement),mui.overlay('off'),updateMapSize()}function toggleSidedrawer(){'hide-sidedrawer'==document.body.className?(isOpenPanel=!0,document.body.className='show-sidedrawer'):(isOpenPanel=!1,document.body.className='hide-sidedrawer'),updateMapSize()}function updateMapSize(){lastWidth>sizeMin&&mui.overlay('off',{onclose:function onclose(){isOpenPanel=!1}}),mapElement.style.height=window.innerHeight-64+'px',mapElement.style.width=window.innerWidth+'px',isOpenPanel&&768<window.innerWidth&&mui.overlay('off');try{google.maps.event.trigger(mapElement,'resize')}catch(b){}}function resize(){updateMapSize()}//init
function init(){lastWidth=window.innerWidth,isOpenPanel=lastWidth>sizeMin,mapElement=document.getElementById('map'),listElement=document.getElementById('list'),sidedrawerElement=document.getElementById('sidedrawer'),window.addEventListener('resize',resize),document.getElementById('search-icon').addEventListener('click',search,!1),document.getElementById('activateModal').addEventListener('click',activateModal,!1),document.getElementById('js-show-sidedrawer').addEventListener('click',showSidedrawer,!1),document.getElementById('js-hide-sidedrawer').addEventListener('click',toggleSidedrawer,!1),updateMapSize(),loadJSON('json/categories.json',function(b){categories=b,loadJSON('json/places.json',function(c){places=c,loadJSON('json/buildings.json',function(d){buildings=d,initList(),getQueryURL()},function(d){console.error(d)})},function(c){console.error(c)})},function(b){console.error(b)})}init();